Could not find scattering factor for Ca 2 Exception that was raised: 'NoneType' object has no attribute 'a'
Try without charge
Could not find scattering factor for Mg 2 Exception that was raised: 'NoneType' object has no attribute 'a'
Try without charge
Parametrization built for 9 unique atom types
MapSymmetry initialized for P     2 1       

  Number of symmetry operations: 2
  Map shape: (223, 277, 251)
MapSymmetry initialized for P     2 1       

  Number of symmetry operations: 2
  Map shape: (223, 277, 251)
CCTBX map shape: (150, 192, 180)
MapSymmetry initialized for P     2 1       

  Number of symmetry operations: 2
  Map shape: (150, 192, 180)
Saving map to /das/work/p17/p17490/Peter/Library/multicopy_refinement/tests/test_FT/quality_testing/me.ccp4
  Map shape: torch.Size([150, 192, 180])
  Map sum: 1030704.25
  Map range: [0.0000, 4.1527]
Map saved successfully
Correlation coefficient: 0.9999838542950901
/var/spool/slurmd/job908446/slurm_script:62: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_me = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(dtached)), hkl))
/var/spool/slurmd/job908446/slurm_script:63: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_cctbx = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(map_cctbx)), hkl))
/var/spool/slurmd/job908446/slurm_script:64: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_noisy = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(noisy_me)), hkl))
====================
Correlation F-me vs F-cctbx: 0.9999852088835882
Correlation phase-me vs phase-cctbx: 0.9645057930589422
Correlation phase-weighted-me vs phase-weighted-cctbx: 0.9031964472592995
--------------------
Correlation F-noisy vs F-cctbx: 0.9998679774054405
Correlation phase-noisy vs phase-me: 0.4787116851523629
Correlation phase-weighted-noisy vs phase-weighted-me: 0.5384740720587906
--------------------
Correlation F-noisy vs F-cctbx: 0.9998679774054405
Correlation phase-noisy vs phase-cctbx: 0.4777769247861712
Correlation phase-weighted-noisy vs phase-weighted-cctbx: 0.562558536773477
--------------------
====================
With normalization:
/var/spool/slurmd/job908446/slurm_script:102: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_me = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(dtached_norm)), hkl))
/var/spool/slurmd/job908446/slurm_script:103: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_cctbx = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(map_cctbx_norm)), hkl))
/var/spool/slurmd/job908446/slurm_script:104: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_noisy = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(noisy_norm)), hkl))
Correlation F-me vs F-cctbx: 0.9999852087899224
Correlation phase-me vs phase-cctbx: 0.9645450949199506
Correlation phase-weighted-me vs phase-weighted-cctbx: 0.8879892170009702
--------------------
Correlation F-noisy vs F-cctbx: 0.9998679772664405
Correlation phase-noisy vs phase-me: 0.4785931942174919
Correlation phase-weighted-noisy vs phase-weighted-me: 0.5216555605374006
--------------------
Correlation F-noisy vs F-cctbx: 0.9998679772664405
Correlation phase-noisy vs phase-cctbx: 0.4776772812344944
Correlation phase-weighted-noisy vs phase-weighted-cctbx: 0.5711836101687854
--------------------
