

=== Testing P21 Symmetry with dilation radius 1 ===
Unit cell: (74.53, 92.58, 83.99, 90, 96.71, 90)
Space group: P 1 21 1 (No. 4)
Original space group: P 1 21 1
Original n_atoms: 17224
Expanded space group: P 1
Expanded n_atoms: 34448

Mask statistics:
  Grid shape: (180, 225, 200)
  Total voxels: 8100000
  Protein voxels (0): 4433361
  Solvent voxels (1): 3666639
  Solvent fraction: 45.27%
Map saved successfully
Building ITC92 parametrization...
Could not find scattering factor for Ca 2 Exception that was raised: 'NoneType' object has no attribute 'a'
Try without charge
Could not find scattering factor for Mg 2 Exception that was raised: 'NoneType' object has no attribute 'a'
Try without charge
Parametrization built for 9 unique atom types
Elements with parametrization: ['C', 'Ca+2', 'Ca', 'Mg+2', 'Mg', 'N', 'O', 'P', 'S']
Setting up grids with max_res=1.0 Å
MapSymmetry initialized for P   1   2 1   1 

  Number of symmetry operations: 2
  Map shape: (180, 225, 200)
Grid shape: torch.Size([180, 225, 200])
Voxel size: tensor([0.3650, 0.4115, 0.4171])
Calculated radius for density calculation: 9 voxels (voxel size: tensor([0.3650, 0.4115, 0.4171])), this corresponds to at least 3.0500001907348633 Å
Calculated radius for density calculation: 4 voxels (voxel size: tensor([0.3650, 0.4115, 0.4171])), this corresponds to at least 1.1 Å

=== Phenix-Style Bulk Solvent Mask Calculation (VECTORIZED) ===
Solvent radius (dilation): 1.10 Å
Shrink truncation radius (erosion): 0.90 Å
Processing 9026 atoms (vectorized)...

After dilation (asymmetric unit):
  Protein core (0): 1379498 voxels (17.0%)
  Accessible surface (-1): 1214125 voxels (15.0%)
  Bulk solvent (1): 5506377 voxels (68.0%)

After applying symmetry:
  Protein core (0): 2401962 voxels (29.7%)
  Accessible surface (-1): 21832 voxels (0.3%)
  Bulk solvent (1): 5676206 voxels (70.1%)

Applying vectorized erosion (shrink_truncation_radius = 0.90 Å)...
/das/work/units/LBR-FEL/p17490/Peter/Library/multicopy_refinement/multicopy_refinement/math_torch.py:1028: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.detach().clone() or sourceTensor.detach().clone().requires_grad_(True), rather than torch.tensor(sourceTensor).
  radius_voxels_x = int(torch.ceil(torch.tensor(shrink_truncation_radius / voxel_size_x)).item())
/das/work/units/LBR-FEL/p17490/Peter/Library/multicopy_refinement/multicopy_refinement/math_torch.py:1029: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.detach().clone() or sourceTensor.detach().clone().requires_grad_(True), rather than torch.tensor(sourceTensor).
  radius_voxels_y = int(torch.ceil(torch.tensor(shrink_truncation_radius / voxel_size_y)).item())
/das/work/units/LBR-FEL/p17490/Peter/Library/multicopy_refinement/multicopy_refinement/math_torch.py:1030: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.detach().clone() or sourceTensor.detach().clone().requires_grad_(True), rather than torch.tensor(sourceTensor).
  radius_voxels_z = int(torch.ceil(torch.tensor(shrink_truncation_radius / voxel_size_z)).item())

Final solvent mask:
  Protein: 2406981 voxels (29.7%)
  Solvent: 5693019 voxels (70.3%)
==================================================

Map saved successfully
Map saved successfully

Figure saved to: /das/work/p17/p17490/Peter/Library/multicopy_refinement/tests/bulk_solvent/P21_dilation_1_mask_comparison_slices.png
Correlation coefficient between masks (P21, dilation 1): 0.221594
[np.float64(0.22159394370388075)]
[1]
