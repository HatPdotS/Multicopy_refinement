Loading CIF file: /das/work/p17/p17490/Peter/Library/multicopy_refinement/scientific_testing/data/7CWW/7CWW.cif
/das/work/units/LBR-FEL/p17490/Peter/Library/multicopy_refinement/multicopy_refinement/io/cif_readers.py:1044: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  return pd.to_numeric(df[col].replace(['?', '.'], default), errors='coerce').fillna(default).astype(int)
Parametrization built for 4 unique atom types
MapSymmetry initialized for P 21 21 21
  Number of symmetry operations: 4
  Map shape: (227, 234, 235)
CCTBX map shape: (160, 160, 160)
MapSymmetry initialized for P 21 21 21
  Number of symmetry operations: 4
  Map shape: (160, 160, 160)
Saving map to /das/work/p17/p17490/Peter/Library/multicopy_refinement/tests_manual/test_FT/quality_testing/me.ccp4
  Map shape: torch.Size([160, 160, 160])
  Map sum: 711137.44
  Map range: [0.0000, 3.0252]
Map saved successfully
Correlation coefficient: 0.4933931732112347
/var/spool/slurmd/job954285/slurm_script:62: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_me = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(dtached)), hkl))
/var/spool/slurmd/job954285/slurm_script:63: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_cctbx = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(map_cctbx)), hkl))
/var/spool/slurmd/job954285/slurm_script:64: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_noisy = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(noisy_me)), hkl))
====================
Correlation F-me vs F-cctbx: 0.9990268616643294
Correlation phase-me vs phase-cctbx: 0.703459679704329
Correlation phase-weighted-me vs phase-weighted-cctbx: 0.7518905572846588
--------------------
Correlation F-noisy vs F-cctbx: 0.9990088106826666
Correlation phase-noisy vs phase-me: 0.6288934474305036
Correlation phase-weighted-noisy vs phase-weighted-me: 0.8331397666027579
--------------------
Correlation F-noisy vs F-cctbx: 0.9990088106826666
Correlation phase-noisy vs phase-cctbx: 0.5419374365046782
Correlation phase-weighted-noisy vs phase-weighted-cctbx: 0.7105070600362687
--------------------
====================
With normalization:
/var/spool/slurmd/job954285/slurm_script:102: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_me = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(dtached_norm)), hkl))
/var/spool/slurmd/job954285/slurm_script:103: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_cctbx = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(map_cctbx_norm)), hkl))
/var/spool/slurmd/job954285/slurm_script:104: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments. To learn more, see the migration guide https://numpy.org/devdocs/numpy_2_0_migration_guide.html#adapting-to-changes-in-the-copy-keyword
  f_noisy = np.array(extract_structure_factor_from_grid(ifft(torch.tensor(noisy_norm)), hkl))
Correlation F-me vs F-cctbx: 0.9990268617028645
Correlation phase-me vs phase-cctbx: 0.7043178489033427
Correlation phase-weighted-me vs phase-weighted-cctbx: 0.6822569232676229
--------------------
Correlation F-noisy vs F-cctbx: 0.9990088106999611
Correlation phase-noisy vs phase-me: 0.6296091697794688
Correlation phase-weighted-noisy vs phase-weighted-me: 0.9063440771551271
--------------------
Correlation F-noisy vs F-cctbx: 0.9990088106999611
Correlation phase-noisy vs phase-cctbx: 0.5418419402012407
Correlation phase-weighted-noisy vs phase-weighted-cctbx: 0.7096483046005273
--------------------
