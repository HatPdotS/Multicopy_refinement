Initializing refinement...
Found 109 link definitions

================================================================================
OPTIMIZER BENCHMARK
================================================================================
Data: /das/work/p17/p17490/Peter/Library/multicopy_refinement/scientific_testing/data/1A0F/1A0F.mtz
Model: /das/work/p17/p17490/Peter/Library/multicopy_refinement/scientific_testing/data/1A0F/1A0F_shaken.pdb
Target weights: {'xray': 1.0, 'restraints': 1.0, 'adp': 0.3}
Optimizers: LBFGS, Adam, AdamW, SGD, RMSprop, Adagrad
Targets: xyz, b
Steps per optimizer: 10
================================================================================



################################################################################
# Testing target: xyz
################################################################################


Testing LBFGS...
Found 109 link definitions

================================================================================
Optimizer: LBFGS | Target: xyz
================================================================================
Total time: 147.84s | Avg time/step: 14.784s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      93.3379      170.8357     0.2724     0.2687    
2      76.1959      120.7222     0.2596     0.2640    
3      63.0182      93.8790      0.2335     0.2383    
4      50.8106      92.6460      0.2152     0.2370    
5      44.9362      96.1343      0.2038     0.2354    
6      42.4465      94.3637      0.1997     0.2386    
7      40.0178      97.2462      0.1947     0.2381    
8      39.8339      100.3693     0.1939     0.2399    
9      36.6133      98.6272      0.1872     0.2388    
10     35.5451      102.9002     0.1852     0.2420    

Improvement:        
  X-ray Work: 93.3379 -> 35.5451 (Δ=-57.7928)
  X-ray Test: 170.8357 -> 102.9002 (Δ=-67.9355)
  R-work:     0.2724 -> 0.1852 (Δ=-0.0873)
  R-free:     0.2687 -> 0.2420 (Δ=-0.0267)


Testing Adam...
Found 109 link definitions

================================================================================
Optimizer: Adam | Target: xyz
================================================================================
Total time: 3.93s | Avg time/step: 0.393s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      114.0512     125.3173     0.3162     0.3174    
2      106.7594     121.7008     0.3028     0.3054    
3      102.0537     118.9402     0.2922     0.2936    
4      100.0963     118.1490     0.2866     0.2866    
5      99.0735      117.8846     0.2840     0.2821    
6      97.3714      116.7749     0.2814     0.2784    
7      95.4070      115.2047     0.2791     0.2756    
8      93.9389      113.8954     0.2780     0.2737    
9      93.2116      113.1313     0.2782     0.2729    
10     92.9511      112.6316     0.2788     0.2726    

Improvement:        
  X-ray Work: 114.0512 -> 92.9511 (Δ=-21.1001)
  X-ray Test: 125.3173 -> 112.6316 (Δ=-12.6856)
  R-work:     0.3162 -> 0.2788 (Δ=-0.0374)
  R-free:     0.3174 -> 0.2726 (Δ=-0.0448)


Testing AdamW...
Found 109 link definitions

================================================================================
Optimizer: AdamW | Target: xyz
================================================================================
Total time: 3.87s | Avg time/step: 0.387s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      114.3216     124.9539     0.3165     0.3174    
2      107.7604     121.8264     0.3046     0.3069    
3      103.4540     119.3266     0.2949     0.2966    
4      101.7341     118.7358     0.2898     0.2904    
5      100.9885     118.9298     0.2875     0.2867    
6      99.6886      118.5292     0.2854     0.2838    
7      98.2508      117.8813     0.2838     0.2815    
8      97.3698      117.6071     0.2835     0.2806    
9      97.2467      117.7865     0.2844     0.2809    
10     97.5762      118.1309     0.2857     0.2814    

Improvement:        
  X-ray Work: 114.3216 -> 97.5762 (Δ=-16.7455)
  X-ray Test: 124.9539 -> 118.1309 (Δ=-6.8230)
  R-work:     0.3165 -> 0.2857 (Δ=-0.0308)
  R-free:     0.3174 -> 0.2814 (Δ=-0.0360)


Testing SGD...
Found 109 link definitions

================================================================================
Optimizer: SGD | Target: xyz
================================================================================
Total time: 3.85s | Avg time/step: 0.385s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      113.6393     134.7179     0.3113     0.3175    
2      5868522.5000 6670592.5000 48.4795    52.8251   
3      900.9033     913.9590     1.0000     1.0000    
4      900.9033     913.9590     1.0000     1.0000    
5      900.9033     913.9590     1.0000     1.0000    
6      900.9033     913.9590     1.0000     1.0000    
7      900.9033     913.9590     1.0000     1.0000    
8      900.9033     913.9590     1.0000     1.0000    
9      900.9033     913.9590     1.0000     1.0000    
10     900.9033     913.9590     1.0000     1.0000    

Improvement:        
  X-ray Work: 113.6393 -> 900.9033 (Δ=787.2640)
  X-ray Test: 134.7179 -> 913.9590 (Δ=779.2412)
  R-work:     0.3113 -> 1.0000 (Δ=0.6887)
  R-free:     0.3175 -> 1.0000 (Δ=0.6825)


Testing RMSprop...
Found 109 link definitions

================================================================================
Optimizer: RMSprop | Target: xyz
================================================================================
Total time: 3.86s | Avg time/step: 0.386s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      217.3782     250.0749     0.5036     0.5200    
2      87.4968      126.8239     0.2768     0.2707    
3      88.3600      120.9050     0.2722     0.2586    
4      95.4376      123.6442     0.2977     0.2942    
5      92.3051      121.2087     0.2740     0.2563    
6      97.5608      121.5072     0.3020     0.2992    
7      86.7099      111.9788     0.2640     0.2452    
8      86.6457      109.0438     0.2739     0.2632    
9      85.0164      107.3579     0.2622     0.2433    
10     84.8288      106.3344     0.2679     0.2544    

Improvement:        
  X-ray Work: 217.3782 -> 84.8288 (Δ=-132.5494)
  X-ray Test: 250.0749 -> 106.3344 (Δ=-143.7405)
  R-work:     0.5036 -> 0.2679 (Δ=-0.2357)
  R-free:     0.5200 -> 0.2544 (Δ=-0.2656)


Testing Adagrad...
Found 109 link definitions

================================================================================
Optimizer: Adagrad | Target: xyz
================================================================================
Total time: 3.84s | Avg time/step: 0.384s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      112.1338     122.7700     0.3108     0.3116    
2      110.5954     119.4082     0.3031     0.3011    
3      110.3513     119.1544     0.3033     0.3011    
4      110.1190     118.7363     0.3025     0.2997    
5      109.8961     118.4618     0.3020     0.2987    
6      109.6803     118.2081     0.3015     0.2978    
7      109.4728     117.9866     0.3010     0.2969    
8      109.2737     117.7834     0.3006     0.2960    
9      109.0829     117.5859     0.3002     0.2952    
10     108.9001     117.3948     0.2998     0.2944    

Improvement:        
  X-ray Work: 112.1338 -> 108.9001 (Δ=-3.2338)
  X-ray Test: 122.7700 -> 117.3948 (Δ=-5.3752)
  R-work:     0.3108 -> 0.2998 (Δ=-0.0110)
  R-free:     0.3116 -> 0.2944 (Δ=-0.0172)


################################################################################
# Testing target: b
################################################################################


Testing LBFGS...
Found 109 link definitions

================================================================================
Optimizer: LBFGS | Target: b
================================================================================
Total time: 134.78s | Avg time/step: 13.478s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      119.7520     130.8831     0.3169     0.3118    
2      112.0378     124.8666     0.3080     0.3057    
3      111.5662     123.3317     0.3060     0.3043    
4      111.5470     123.3526     0.3066     0.3043    
5      111.6731     122.9583     0.3069     0.3044    
6      111.5802     122.4717     0.3068     0.3045    
7      111.1810     128.6118     0.3061     0.3044    
8      110.8064     126.0811     0.3039     0.3038    
9      110.7539     126.3206     0.3040     0.3042    
10     110.4978     125.1346     0.3042     0.3033    

Improvement:        
  X-ray Work: 119.7520 -> 110.4978 (Δ=-9.2542)
  X-ray Test: 130.8831 -> 125.1346 (Δ=-5.7485)
  R-work:     0.3169 -> 0.3042 (Δ=-0.0127)
  R-free:     0.3118 -> 0.3033 (Δ=-0.0084)


Testing Adam...
Found 109 link definitions

================================================================================
Optimizer: Adam | Target: b
================================================================================
Total time: 3.81s | Avg time/step: 0.381s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      121.9850     122.0065     0.3176     0.3106    
2      120.5644     122.4443     0.3184     0.3136    
3      121.1176     124.4800     0.3218     0.3177    
4      121.2857     125.5030     0.3224     0.3185    
5      120.7684     125.3874     0.3206     0.3166    
6      120.3550     125.1650     0.3184     0.3140    
7      120.4569     125.4825     0.3171     0.3119    
8      120.7461     126.2670     0.3167     0.3113    
9      120.7279     127.0914     0.3168     0.3115    
10     120.4673     127.8542     0.3171     0.3122    

Improvement:        
  X-ray Work: 121.9850 -> 120.4673 (Δ=-1.5177)
  X-ray Test: 122.0065 -> 127.8542 (Δ=5.8477)
  R-work:     0.3176 -> 0.3171 (Δ=-0.0004)
  R-free:     0.3106 -> 0.3122 (Δ=0.0016)


Testing AdamW...
Found 109 link definitions

================================================================================
Optimizer: AdamW | Target: b
================================================================================
Total time: 3.79s | Avg time/step: 0.379s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      122.2428     125.2696     0.3241     0.3199    
2      120.6562     122.3374     0.3182     0.3133    
3      121.0945     121.6087     0.3163     0.3098    
4      121.3838     122.2190     0.3165     0.3099    
5      120.8009     122.9005     0.3168     0.3109    
6      120.3712     124.0606     0.3178     0.3130    
7      120.4860     125.7139     0.3196     0.3155    
8      120.7569     127.2407     0.3209     0.3170    
9      120.7579     128.1550     0.3210     0.3171    
10     120.5209     128.5339     0.3200     0.3160    

Improvement:        
  X-ray Work: 122.2428 -> 120.5209 (Δ=-1.7219)
  X-ray Test: 125.2696 -> 128.5339 (Δ=3.2643)
  R-work:     0.3241 -> 0.3200 (Δ=-0.0042)
  R-free:     0.3199 -> 0.3160 (Δ=-0.0039)


Testing SGD...
Found 109 link definitions

================================================================================
Optimizer: SGD | Target: b
================================================================================
Total time: 3.76s | Avg time/step: 0.376s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      147.5246     159.8380     0.3760     0.3782    
2      955417742737932288.0000 919856032002342912.0000 7038301.5000 8450571.0000
3      900.9351     913.9590     1.0000     1.0000    
4      900.9351     913.9590     1.0000     1.0000    
5      900.9351     913.9590     1.0000     1.0000    
6      900.9351     913.9590     1.0000     1.0000    
7      900.9351     913.9590     1.0000     1.0000    
8      900.9351     913.9590     1.0000     1.0000    
9      900.9351     913.9590     1.0000     1.0000    
10     900.9351     913.9590     1.0000     1.0000    

Improvement:        
  X-ray Work: 147.5246 -> 900.9351 (Δ=753.4104)
  X-ray Test: 159.8380 -> 913.9590 (Δ=754.1210)
  R-work:     0.3760 -> 1.0000 (Δ=0.6240)
  R-free:     0.3782 -> 1.0000 (Δ=0.6218)


Testing RMSprop...
Found 109 link definitions

================================================================================
Optimizer: RMSprop | Target: b
================================================================================
Total time: 3.75s | Avg time/step: 0.375s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      385.2964     363.0001     0.5830     0.5695    
2      135.4785     141.2406     0.3494     0.3499    
3      126.3552     132.9558     0.3317     0.3289    
4      122.9848     129.3261     0.3238     0.3197    
5      121.7660     127.6703     0.3205     0.3162    
6      121.2737     126.9122     0.3191     0.3147    
7      121.0183     126.5760     0.3185     0.3141    
8      120.8524     126.4430     0.3182     0.3140    
9      120.7312     126.4054     0.3181     0.3140    
10     120.6382     126.4108     0.3181     0.3141    

Improvement:        
  X-ray Work: 385.2964 -> 120.6382 (Δ=-264.6582)
  X-ray Test: 363.0001 -> 126.4108 (Δ=-236.5893)
  R-work:     0.5830 -> 0.3181 (Δ=-0.2648)
  R-free:     0.5695 -> 0.3141 (Δ=-0.2554)


Testing Adagrad...
Found 109 link definitions

================================================================================
Optimizer: Adagrad | Target: b
================================================================================
Total time: 3.76s | Avg time/step: 0.376s

Step   X-ray Work   X-ray Test   R-work     R-free    
------------------------------------------------------------
1      121.7992     124.7399     0.3237     0.3196    
2      120.6690     121.7160     0.3177     0.3121    
3      120.5853     122.3421     0.3187     0.3137    
4      120.5626     122.4883     0.3183     0.3133    
5      120.5489     122.9382     0.3184     0.3135    
6      120.5373     123.3302     0.3184     0.3135    
7      120.5273     123.7208     0.3184     0.3136    
8      120.5185     124.0762     0.3184     0.3136    
9      120.5110     124.4018     0.3184     0.3137    
10     120.5044     124.6949     0.3184     0.3137    

Improvement:        
  X-ray Work: 121.7992 -> 120.5044 (Δ=-1.2948)
  X-ray Test: 124.7399 -> 124.6949 (Δ=-0.0450)
  R-work:     0.3237 -> 0.3184 (Δ=-0.0053)
  R-free:     0.3196 -> 0.3137 (Δ=-0.0059)


================================================================================
SUMMARY: Optimizer Comparison
================================================================================


Target: xyz
--------------------------------------------------------------------------------
Optimizer       Final R-work    Final R-free    Time (s)    
--------------------------------------------------------------------------------
LBFGS           0.1852          0.2420          147.84      
Adam            0.2788          0.2726          3.93        
AdamW           0.2857          0.2814          3.87        
SGD             1.0000          1.0000          3.85        
RMSprop         0.2679          0.2544          3.86        
Adagrad         0.2998          0.2944          3.84        

Target: b
--------------------------------------------------------------------------------
Optimizer       Final R-work    Final R-free    Time (s)    
--------------------------------------------------------------------------------
LBFGS           0.3042          0.3033          134.78      
Adam            0.3171          0.3122          3.81        
AdamW           0.3200          0.3160          3.79        
SGD             1.0000          1.0000          3.76        
RMSprop         0.3181          0.3141          3.75        
Adagrad         0.3184          0.3137          3.76        
